"use strict";function handleExistingProfile(e){getProfile(e).then(function(e){1==e.data.length&&(console.log("Saving profile"),saveProfile(e))})["catch"](function(e){console.log("Promise failed "+e)})}function getEmailQueryParam(){return getParameterByName("email")}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i"),a=o.exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function checkForUpgrade(){var e=localStorage.getItem("version");null==e?localStorage.setItem("version",1):e>version&&performUpgrade()}function performUpgrade(){var e=localStorage.getItem("profile_id");getProfileById(e).then(function(e){1==e.data.length&&(saveProfile(e),localStorage.setItem("version",1))})["catch"](function(e){console.log("Failed to retrieve profile by ID "+e)})}function setProfileLink(){var e=JSON.parse(localStorage.getItem("profile")).firstname;e&&$("#profile_link").text(e)}function createProfile(e){return new Promise(function(t,o){$.ajax({type:"post",url:apiDomainURL+"/profiles",data:e,headers:{Accept:"application/json","Content-Type":"application/vnd.api+json"},dataType:"JSON"}).success(function(e){t(e)}).error=o})}function saveProfile(e){console.log("Saving profile to local storage "+e),localStorage.setItem("profile",JSON.stringify(e.data[0].attributes)),localStorage.setItem("profile_id",JSON.stringify(e.data[0].id)),console.log("retrievedObject: ",JSON.parse(localStorage.getItem("profile"))),loadProfileToForm()}function loadProfileToForm(){var e=$("#profile"),t=JSON.parse(localStorage.getItem("profile")),o=JSON.parse(localStorage.getItem("linked_profile"));null!=t&&(e.find('input[name="firstname"]').val(t.firstname),e.find('input[name="lastname"]').val(t.lastname),e.find('input[name="email"]').val(t.email),setProfileLink()),null!=o&&e.find('input[name="partner_email"]').val(o.email)}function setupPartner(e){getProfile(e).then(function(t){1==t.data.length?(console.log("Partner email found "+t),localStorage.setItem("linked_profile",JSON.stringify(t.data[0].attributes)),localStorage.setItem("linked_profile_id",JSON.stringify(t.data[0].id))):(invitePartner(e),console.log("Invite sent to partner")),window.location="AccountSuccess.html"})["catch"](function(e){console.log("Promise failed "+e),window.location="AccountSuccess.html"})}function getProfile(e){return new Promise(function(t,o){$.ajax({type:"get",url:apiDomainURL+"/profiles?filter[email]="+e,headers:{Accept:"application/json"},dataType:"JSON"}).success(function(e){console.log("JSON success response"+e),t(e)}).error=o})}function getProfileById(e){return new Promise(function(t,o){$.ajax({type:"get",url:apiDomainURL+"/profiles/"+e,headers:{Accept:"application/json"},dataType:"JSON"}).success(function(e){console.log("JSON success response"+e),t(e)}).error=o})}function invitePartner(e){$.ajax({type:"post",url:mailDomainURL+"/invite_partner",data:{invite:{email:e,id:localStorage.getItem("profile_id")}},headers:{Accept:"application/json"},dataType:"JSON"}).success(function(t){console.log("JSON success response",t),toastr.info("Invitation successfully sent to "+e+". <br /> Make sure to revisit this page once your partner registers.","Sent!")}).error(function(e){console.log(e),toastr.error("There was a problem finding the account.")})}var version=1,apiDomainURL="";apiDomainURL="localhost"===window.location.hostname?"http://localhost:3000":"https://frank.treasury.love";var mailDomainURL="";mailDomainURL="localhost"===window.location.hostname?"http://localhost:3001":"https://frank-mail.treasury.love",$(document).ready(function(){loadProfileToForm(),checkForUpgrade();var e=getEmailQueryParam();null!=e&&(console.log("Found email query parameter "+e),getProfile(e).then(function(t){1==t.data.length?(console.log("Saving profile"),saveProfile(t),window.location="AccountSuccess.html"):$("#profile").find('input[name="email"]').val(e)})["catch"](function(e){console.log("Promise failed "+e)})),$("input[name=email]").focusout(function(){var e=$(this).val();null!=e&&handleExistingProfile(e)})}),$("#profile").submit(function(){var e=$(this).find('input[name="firstname"]').val(),t=$(this).find('input[name="lastname"]').val(),o=$(this).find('input[name="email"]').val(),a=$(this).find('input[name="partner_email"]').val(),n='{"data": {"type":"profiles", "attributes":{"firstname":"'+e+'", "lastname":"'+t+'", "email":"'+o+'"}}}';null==JSON.parse(localStorage.getItem("profile"))?createProfile(n).then(function(e){1==e.data.length&&(console.log("Saving profile"),saveProfile(e),setupPartner(a))})["catch"](function(e){console.log("Promise failed "+e)}):setupPartner(a),event.preventDefault()}),function(e){e("a.page-scroll").bind("click",function(t){var o=e(this);e("html, body").stop().animate({scrollTop:e(o.attr("href")).offset().top-50},1250,"easeInOutExpo"),t.preventDefault()}),e("body").scrollspy({target:".navbar-fixed-top",offset:51}),e(".navbar-collapse ul li a").click(function(){e(".navbar-toggle:visible").click()}),e("h1").fitText(1.2,{minFontSize:"35px",maxFontSize:"65px"}),e("#mainNav").affix({offset:{top:100}}),(new WOW).init()}(jQuery);